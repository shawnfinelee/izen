# 禅道工作日志耗时统计脚本

## 📋 功能介绍

这是一个专门用于统计禅道系统中工作日志耗时的JavaScript脚本，能够自动识别并计算 `class="main-table table-effort"` 表格中的总耗时。

### ✨ 主要特性

- 🎯 **精准识别**：自动识别禅道工作日志表格
- 🕐 **多格式支持**：支持多种时间格式（纯数字、小时h、分钟m、中文格式等）
- ✅ **自动验证**：与页面显示的总计数据进行对比验证
- 📊 **详细报告**：提供完整的统计报告和调试信息
- 🔧 **易于使用**：简单的函数调用即可完成统计

## 🚀 使用方法

### 方法一：直接在浏览器控制台使用

1. 打开禅道工作日志页面（如：`https://proj.uhouzz.com/my-effort-20250714.html`）
2. 按 `F12` 打开浏览器开发者工具
3. 切换到 `Console`（控制台）标签
4. 复制并粘贴 `effort-calculator-complete.js` 文件的内容
5. 按回车执行脚本
6. 调用 `calculateEffort()` 函数开始统计

```javascript
// 详细模式（显示调试信息）
const result = calculateEffort();

// 静默模式（不显示调试信息）
const result = calculateEffortQuiet();
```

### 方法二：作为书签使用

1. 将脚本内容压缩为一行
2. 在浏览器中创建书签，URL设置为：
```javascript
javascript:(function(){/* 脚本内容 */})();
```
3. 在工作日志页面点击书签即可执行

## 📊 输出结果

脚本执行后会返回一个包含以下信息的对象：

```javascript
{
  success: true,              // 执行是否成功
  version: "1.0",            // 脚本版本
  timestamp: "2025-07-15T07:00:00.000Z", // 执行时间
  totalHours: 8.0,           // 总耗时（小时）
  recordCount: 2,            // 记录数量
  records: [                 // 详细记录数组
    {
      tableIndex: 0,
      rowIndex: 0,
      id: "125709",
      date: "2025-07-14",
      work: "done",
      effort: 4,
      effortText: "4"
    },
    // ... 更多记录
  ],
  summary: "📊 工作日志统计摘要...", // 文本摘要
  pageUrl: "https://proj.uhouzz.com/my-effort-20250714.html"
}
```

## 🎯 测试结果

基于实际测试，脚本能够正确识别和统计以下数据：

### 测试页面：`https://proj.uhouzz.com/my-effort-20250714.html`

**统计结果：**
- 📅 统计日期：2025-07-14
- 📝 记录数量：2 条
- ⏱️ 总耗时：8.0 小时

**详细记录：**
1. 任务 #82702 - "done" - 4小时
2. 任务 #81770 - "开发提测" - 4小时

**验证结果：** ✅ 与页面显示的"本页总消耗8.0小时"完全一致

## 🔧 支持的时间格式

脚本支持以下时间格式的自动识别和转换：

- `4` - 纯数字（默认为小时）
- `1.5h` - 小时格式
- `30m` - 分钟格式
- `2小时` - 中文小时
- `30分钟` - 中文分钟
- `2h30m` - 复合格式

## 📁 文件说明

- `effort-calculator.js` - 基础版本脚本
- `effort-calculator-complete.js` - 完整版本脚本（推荐使用）
- `effort-test.js` - 简化测试脚本
- `README-effort-calculator.md` - 本说明文档

## 🐛 故障排除

### 常见问题

1. **脚本无法找到表格**
   - 确认页面已完全加载
   - 检查表格是否存在 `class="main-table table-effort"` 属性
   - 尝试刷新页面后重新执行

2. **统计结果为0**
   - 检查表格中是否有数据
   - 确认耗时列的数据格式是否正确
   - 开启调试模式查看详细信息：`calculateEffort(true)`

3. **验证失败**
   - 可能是页面显示的总计与实际数据不符
   - 检查是否有隐藏的数据行
   - 手动验证几条记录确认脚本计算是否正确

### 调试模式

开启调试模式可以查看详细的执行过程：

```javascript
const result = calculateEffort(true); // 开启调试
```

调试信息包括：
- 表格查找过程
- 列识别结果
- 每条记录的处理情况
- 验证对比结果

## 📝 更新日志

### v1.0 (2025-07-15)
- ✨ 初始版本发布
- 🎯 支持禅道工作日志表格识别
- 📊 支持多种时间格式解析
- ✅ 支持自动验证功能
- 📋 提供详细统计报告

## 👨‍💻 技术支持

如果在使用过程中遇到问题，可以：

1. 检查浏览器控制台的错误信息
2. 确认页面结构是否与脚本预期一致
3. 尝试在不同的工作日志页面测试
4. 联系开发者获取技术支持

## 📄 许可证

本脚本仅供学习和内部使用，请勿用于商业用途。
